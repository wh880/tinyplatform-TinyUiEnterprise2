#macro checkTreeForm(itemName,checkList,optionMap)#set(treeFormId=fmt("tf%d",rand()))
<div class="zTreeDemoBackground left">
    <ul id="${treeFormId}" class="ztree check-ztree"></ul>
    <input type="hidden" name="${itemName}" value="${checkList}" id="${treeFormId}-input">
</div>
<SCRIPT type="text/javascript">
    (function(){
        var setting = {
            check: {
                enable: true,
                chkboxType : { "Y" : "s", "N" : "ps" }
            },
            data: {
                simpleData: {
                    enable: true
                }
            },
            callback: {
                onCheck: onCheck
            }
        };
        var zNodes =[
            #bodyContent
        ];
        var _ztree;
        var checklist="${checkList}";

        var thisList=checklist.split("${optionMap?.split?:"|"}");
        for(var i=0,l=thisList.length;i<l;i++){
            for(var j=0,nl=zNodes.length;j<nl;j++){
                if(zNodes[j].id==thisList[i]){
                    zNodes[j].checked=true;
                }
            }
        }
        function onCheck(e, treeId, treeNode) {
            var checkNodes=_ztree.getCheckedNodes(true);
            var checkNodeIds=[];
            for(var i=0,l=checkNodes.length;i<l;i++){
                checkNodeIds.push(checkNodes[i]["id"])
            }
            console.log(checkNodeIds.join("|"));
            $("#${treeFormId}-input").val(checkNodeIds.join("|"));
        }
        $(function(){
            _ztree=$.fn.zTree.init($("#${treeFormId}"), setting, zNodes);
        });
    })();

</SCRIPT>
#end

#@checkTreeForm("authorlist","221,222,23",{"split":","})
    { id:1, pId:0, name:"随意勾选 1"},
    { id:11, pId:1, name:"随意勾选 1-1"},
    { id:111, pId:11, name:"随意勾选 1-1-1"},
    { id:112, pId:11, name:"随意勾选 1-1-2"},
    { id:12, pId:1, name:"随意勾选 1-2"},
    { id:121, pId:12, name:"随意勾选 1-2-1"},
    { id:122, pId:12, name:"随意勾选 1-2-2"},
    { id:2, pId:0, name:"随意勾选 2"},
    { id:21, pId:2, name:"随意勾选 2-1"},
    { id:22, pId:2, name:"随意勾选 2-2"},
    { id:221, pId:22, name:"随意勾选 2-2-1"},
    { id:222, pId:22, name:"随意勾选 2-2-2"},
    { id:23, pId:2, name:"随意勾选 2-3"}
#end