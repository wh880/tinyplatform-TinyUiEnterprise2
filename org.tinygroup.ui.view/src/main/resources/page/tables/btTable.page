#macro bootstrapTable(mapInfo)
<table #mapToHtml(mapInfo)>
    #bodyContent
</table>
#end


#macro btTable(tableId)#set(tableId=tableId?:fmt("t%d",rand()))<div id="${tableId}">#bodyContent</div>
<script>
    $(function(){
        //$("#${tableId}-table>thead>tr>.operate").attr("data-formatter",$.trim($("#${tableId}-operate").html()));
        // $("#${tableId}-table").bootstrapTable('destroy').bootstrapTable();
        $("#${tableId}-table").bootstrapTable('destroy').bootstrapTable();

    })
</script>
#end
#macro btTableContent(dataUrl,btMap)#set(
defaultMap={
    "data-side-pagination":"server",
    "data-pagination":"true",
    "data-page-size":"10",
    "data-page-list":"[10, 20, 50, 100, 200,all]",
    "data-click-to-select":"true",
    "data-show-columns":"true",
    "data-search":"true",
    "data-toolbar":"#"+tableId+"-toolbar",
    "data-show-refresh":"false",
    "data-show-toggle":"false",
    "data-show-columns":"true",
    "data-show-export":"false",
    "data-show-pagination-switch":"false",
    "data-id-field":"id",
    "data-show-footer":"false"
},btMap=defaultMap.extend(btMap,true))
<table id="${tableId}-table"  data-url="#link(dataUrl)"  #mapToHtml(btMap)>
    <thead>
    <tr>
        #bodyContent
        <th data-field="operate" class="operate" data-align="center" data-click-to-select="false">操作</th>
    </tr>
    </thead>
</table>
#end
#macro btTableOperate()
<div id="${tableId}-operate" class="hidden">#bodyContent</div>
#end
#macro btToolBar()
<div class="btn-group hidden-xs" id="${tableId}-toolbar" role="group">
    #bodyContent
</div>
#end
#macro btForm(formMap)#set(formMap=formMap?:{"id":fmt("f%d",rand())},formid=formMap?.id?:fmt("f%d",rand()),formMap=formMap.extend({"id":formid,"method":"get"},true))
<form #mapToHtml(formMap)>
    #bodyContent
</form>
<script type="text/javascript">
    $(function () {
        $("#${formid}").Validform({
            tiptype: 1,
            beforeSubmit: function (curform) {
                var options=$("#${tableId}-table").bootstrapTable("getOptions");
                var formData=$("#${formid}").serializeArray();
                formData.push({name:"sortName",value:options.sortName});
                formData.push({name:"sortOrder",value:options.sortOrder});
                formData.push({name:"pageNo",value:1});
                formData.push({name:"pageSize",value:options.pageSize});
                options=$.extend({},options,{queryParams: formData});
                $("#${tableId}-table").bootstrapTable('destroy').bootstrapTable(options);
                return false;
            }
        });
    });
</script>
#end


#@btTable("tableid")
    #@btForm()
        <div class="well well-sm form-inline">
            用户名:#tInput("username" username?:"" {"size":"10","class":"input-sm"}) 城市:
            #tInput("city" city?:"" {"size":"10","class":"input-sm"})
            <input type="submit" class="btn btn-primary btn-sm" value="搜索" />
            <input type="reset" class="btn btn-primary btn-sm" value="重置" />
            #saveFormHistory()
        </div>
    #end
    #@btToolBar()
    <button type="button" class="btn btn-default">#faIcon("plus")</button>
    <button type="button" class="btn btn-default mul-remove">#faIcon("trash")</button>
    <button type="button" class="btn btn-default opt-refresh">状态</button>
    <button type="button" class="btn btn-default opt-refresh">指派</button>

    #end
    #@btTableContent("/data/bt_table_data.pagelet",{"data-page-list":"[15, 20, 50, 100, 200,all]","data-page-size":"15","data-id-field":"id"})
    <th data-field="state" data-checkbox="true"></th>
    #*<th data-field="id" data-sortable="true">ID</th>*#
    <th data-field="name" data-sortable="true">Item Name</th>
    <th data-field="price" data-sortable="true">Item Price</th>
    #end
    #@btTableOperate()
    <a href="#" class="edit">#faIcon("edit")</a>
    <a href="#" class="remove">#faIcon("remove")</a>
    #end
#hideModal("table-edit" {"width":"800","height":"400"})
<script>
    $(function(){
        var _table=$("#${tableId}")
        $("#${tableId}").on("click.remove",".remove",function(){
            var id=$(this).closest("tr").find("input[type=checkbox]:first").val();

            layer.confirm("确定要删除吗",{title:"删除信息"},function(){
                $.ajax({
                    url:"#link("/data/bt_table_data.pagelet")",
                    type:"post",
                    data:{id:id},
                    dataType:"json",
                    success:function(data){
                        var info="系统错误";
                        if(typeof(data.info)!='undefined'){
                            info=data.info;
                        }
                        if(data&&data.status&&data.status=="y"){
                            layer.msg(info);
                        }else{
                            layer.msg(info,{icon:2})
                        }
                        $("#${tableId}-table").bootstrapTable('refresh');
                    },
                    error:function(e){
                        layer.msg("error",{icon:2})
                    }
                })
            });
            return false;
        }).off("click.mulremove").on("click.mulremove",".mul-remove",function(){
            console.log("批量删除");
            var sels=$("#${tableId}-table").bootstrapTable('getSelections');
            console.log(sels);
            var ids=[];
            for(var i= 0,l=sels.length;i<l;i++){
                ids.push(sels[i].id);
            }
            $.ajax({
                url:"#link("/data/bt_table_data.pagelet")",
                type:"post",
                data:{idItem:ids,ids:ids.join(",")},
                dataType:"json",
                success:function(data){
                    var info="系统错误";
                    if(typeof(data.info)!='undefined'){
                        info=data.info;
                    }
                    if(data&&data.status&&data.status=="y"){
                        layer.msg(info);
                    }else{
                        layer.msg(info,{icon:2})
                    }
                    $("#${tableId}-table").bootstrapTable('refresh');
                },
                error:function(e){
                    layer.msg("error",{icon:2})
                }
            })
            return false;
        }).on("click.edit",".edit",function(){
            var id=$(this).closest("tr").find("input[type=checkbox]:first").val();
            var url="#link("data/bt_table_data.pagelet")?id="+id;
            //弹框
            $("#table-edit").attr({"data-title":"修改","href":url}).trigger("click.modal");
            //window.location.href=url
            return false;
        })
    })
</script>
#end