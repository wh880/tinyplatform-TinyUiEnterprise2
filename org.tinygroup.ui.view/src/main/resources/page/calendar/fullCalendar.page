
#macro fullCalendar(fcid defaultDate dataUrl doAction)
    #set(wcid=fcid?:fmt("wcid%d",rand()))
<div  style="position:relative">
    <div class="workcalendar">
        <div class='showbody' id="${wcid}"></div>
        <div id="${wcid}-showtitle" class="wc-showtitle"></div>
        <script>
            $(function(){
                var $modalLink=$("#m${wcid}");
                var dolink="${doAction}";
                dolink+=dolink.indexOf("?")>-1?"&":"?";
                dolink+="fcid=${fcid}&"
                $("#${wcid}-showtitle").on("click",function(){
                    var that=this;
                    WdatePicker({
                        startDate:'%y-%M-01',dateFmt:"yyyy-MM",
                        onpicked:function(){
                                $calendar.fullCalendar('gotoDate',$(that).html());
                        }
                    })
                });
                var $calendar=$('#${wcid}');
                var olddate=moment().format("YYYY-MM-DD");
                    $calendar.fullCalendar({
                    header: {
                    left: 'prev',
                    center: 'title',
                    right: 'next'
                    },
                    events: '${dataUrl}',
                    defaultDate:"${defaultDate}",//moment().format("YYYY-MM-DD"),
                    businessHours: true, // display business hours
                    editable: true,
                    eventLimit: true,
                    dayClick: function(date, allDay, jsEvent, view) {
                    olddate=date;
                        $modalLink.attr({"href":dolink+"date="+date.format("YYYY-MM-DD")+"&action=add","modal-title":"增加事件"});
                        $modalLink.trigger("click");
                    },
                    eventClick:function( event, jsEvent, view ) {
                    olddate=event.start;
                        $modalLink.attr({"href":dolink+"id="+event.id+"&action=edit","modal-title":"修改事件"});
                        $modalLink.trigger("click");
                    }
                    });
                $calendar.on("refresh",function(e){
                $(this).fullCalendar('refetchEvents');//fullCalendar( 'rerenderEvents' );//fullCalendar('refetchResources');
            })
            });
        </script>
    </div>
</div>#hideModal("m"+wcid {"url":doAction,"width":"80%"})
#end

#fullCalendar('fullCalendar' '2015-02-12' call("link",'/data/calendar.pagelet') call("link",'/data/calendarEvent.pagelet'))