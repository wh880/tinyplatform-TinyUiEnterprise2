(function(){TinyAdmin.MainMenu=function(){this._screen=null;this._last_screen=null;this._animate=false;this._close_timer=null;this._dropdown_li=null;this._dropdown=null;return this};TinyAdmin.MainMenu.prototype.init=function(){var a,b;this.$menu=$("#main-menu");if(!this.$menu.length){return}this.$body=$("body");this.menu=this.$menu[0];this.$ssw_point=$("#small-screen-width-point");this.$tsw_point=$("#tablet-screen-width-point");a=this;if(TinyAdmin.settings.main_menu.store_state){b=this._getMenuState();document.body.className+=" disable-mm-animation";if(b!==null){this.$body[b==="collapsed"?"addClass":"removeClass"]("mmc")}setTimeout((function(c){return function(){return elRemoveClass(document.body,"disable-mm-animation")}})(this),20)}this.setupAnimation();$(window).on("resize.pa.mm",$.proxy(this.onResize,this));this.onResize();this.$menu.find(".navigation > .mm-dropdown").addClass("mm-dropdown-root");if(TinyAdmin.settings.main_menu.detect_active){this.detectActiveItem()}if($.support.transition){this.$menu.on("transitionend webkitTransitionEnd oTransitionEnd MSTransitionEnd",$.proxy(this._onAnimationEnd,this))}$("#main-menu-toggle").on("click",$.proxy(this.toggle,this));$("#main-menu-inner").slimScroll({height:"100%"}).on("slimscrolling",(function(c){return function(){return c.closeCurrentDropdown(true)}})(this));this.$menu.on("click",".mm-dropdown > a",function(){var c;c=this.parentNode;if(elHasClass(c,"mm-dropdown-root")&&a._collapsed()){if(elHasClass(c,"mmc-dropdown-open")){if(elHasClass(c,"freeze")){a.closeCurrentDropdown(true)}else{a.freezeDropdown(c)}}else{a.openDropdown(c,true)}}else{a.toggleSubmenu(c)}return false});this.$menu.find(".navigation").on("mouseenter.pa.mm-dropdown",".mm-dropdown-root",function(){a.clearCloseTimer();if(a._dropdown_li===this){return}if(a._collapsed()&&(!a._dropdown_li||!elHasClass(a._dropdown_li,"freeze"))){return a.openDropdown(this)}}).on("mouseleave.pa.mm-dropdown",".mm-dropdown-root",function(){return a._close_timer=setTimeout(function(){return a.closeCurrentDropdown()},TinyAdmin.settings.main_menu.dropdown_close_delay)});return this};TinyAdmin.MainMenu.prototype._collapsed=function(){return(this._screen==="desktop"&&elHasClass(document.body,"mmc"))||(this._screen!=="desktop"&&!elHasClass(document.body,"mme"))};TinyAdmin.MainMenu.prototype.onResize=function(){this._screen=getScreenSize(this.$ssw_point,this.$tsw_point);this._animate=TinyAdmin.settings.main_menu.disable_animation_on.indexOf(screen)===-1;if(this._dropdown_li){this.closeCurrentDropdown(true)}if((this._screen==="small"&&this._last_screen!==this._screen)||(this._screen==="tablet"&&this._last_screen==="small")){document.body.className+=" disable-mm-animation";setTimeout((function(a){return function(){return elRemoveClass(document.body,"disable-mm-animation")}})(this),20)}return this._last_screen=this._screen};TinyAdmin.MainMenu.prototype.clearCloseTimer=function(){if(this._close_timer){clearTimeout(this._close_timer);return this._close_timer=null}};TinyAdmin.MainMenu.prototype._onAnimationEnd=function(a){if(this._screen!=="desktop"||a.target.id!=="main-menu"){return}return $(window).trigger("resize")};TinyAdmin.MainMenu.prototype.toggle=function(){var a,b;a=this._screen==="small"||this._screen==="tablet"?"mme":"mmc";if(elHasClass(document.body,a)){elRemoveClass(document.body,a)}else{document.body.className+=" "+a}if(a==="mmc"){if(TinyAdmin.settings.main_menu.store_state){this._storeMenuState(elHasClass(document.body,"mmc"))}if(!$.support.transition){return $(window).trigger("resize")}}else{b=document.getElementById("");$("#main-navbar-collapse").stop().removeClass("in collapsing").addClass("collapse")[0].style.height="0px";return $("#main-navbar .navbar-toggle").addClass("collapsed")}};TinyAdmin.MainMenu.prototype.toggleSubmenu=function(a){this[elHasClass(a,"open")?"collapseSubmenu":"expandSubmenu"](a);return false};TinyAdmin.MainMenu.prototype.collapseSubmenu=function(a){var c,b;c=$(a);b=c.find("> ul");if(this._animate){b.animate({height:0},TinyAdmin.settings.main_menu.animation_speed,(function(d){return function(){elRemoveClass(a,"open");b.attr("style","");return c.find(".mm-dropdown.open").removeClass("open").find("> ul").attr("style","")}})(this))}else{elRemoveClass(a,"open")}return false};TinyAdmin.MainMenu.prototype.expandSubmenu=function(a){var e,b,d,c;e=$(a);if(TinyAdmin.settings.main_menu.accordion){this.collapseAllSubmenus(a)}if(this._animate){b=e.find("> ul");c=b[0];c.className+=" get-height";d=b.height();elRemoveClass(c,"get-height");c.style.display="block";c.style.height="0px";a.className+=" open";return b.animate({height:d},TinyAdmin.settings.main_menu.animation_speed,(function(f){return function(){return b.attr("style","")}})(this))}else{return a.className+=" open"}};TinyAdmin.MainMenu.prototype.collapseAllSubmenus=function(a){var b;b=this;return $(a).parent().find("> .mm-dropdown.open").each(function(){return b.collapseSubmenu(this)})};TinyAdmin.MainMenu.prototype.openDropdown=function(m,c){var i,k,e,f,h,l,d,j,g,b,a;if(c==null){c=false}if(this._dropdown_li){this.closeCurrentDropdown(c)}i=$(m);e=i.find("> ul");g=e[0];this._dropdown_li=m;this._dropdown=g;k=e.find("> .mmc-title");if(!k.length){k=$('<div class="mmc-title"></div>').text(i.find("> a > .mm-text").text());g.insertBefore(k[0],g.firstChild)}m.className+=" mmc-dropdown-open";g.className+=" mmc-dropdown-open-ul";j=i.position().top;if(elHasClass(document.body,"main-menu-fixed")){f=e.find(".mmc-wrapper");if(!f.length){a=document.createElement("div");a.className="mmc-wrapper";a.style.overflow="hidden";a.style.position="relative";f=$(a);f.append(e.find("> li"));g.appendChild(a)}b=$(window).innerHeight();d=k.outerHeight();l=d+e.find(".mmc-wrapper > li").first().outerHeight()*3;if((j+l)>b){h=j-$("#main-navbar").outerHeight();g.className+=" top";g.style.bottom=(b-j-d)+"px"}else{h=b-j-d;g.style.top=j+"px"}if(elHasClass(g,"top")){g.appendChild(k[0])}else{g.insertBefore(k[0],g.firstChild)}m.className+=" slimscroll-attached";f[0].style.maxHeight=(h-10)+"px";f.pixelSlimScroll({})}else{g.style.top=j+"px"}if(c){this.freezeDropdown(m)}if(!c){e.on("mouseenter",(function(n){return function(){return n.clearCloseTimer()}})(this)).on("mouseleave",(function(n){return function(){return n._close_timer=setTimeout(function(){return n.closeCurrentDropdown()},TinyAdmin.settings.main_menu.dropdown_close_delay)}})(this));this}return this.menu.appendChild(g)};TinyAdmin.MainMenu.prototype.closeCurrentDropdown=function(b){var c,a;if(b==null){b=false}if(!this._dropdown_li||(elHasClass(this._dropdown_li,"freeze")&&!b)){return}this.clearCloseTimer();c=$(this._dropdown);if(elHasClass(this._dropdown_li,"slimscroll-attached")){elRemoveClass(this._dropdown_li,"slimscroll-attached");a=c.find(".mmc-wrapper");a.pixelSlimScroll({destroy:"destroy"}).find("> *").appendTo(c);a.remove()}this._dropdown_li.appendChild(this._dropdown);elRemoveClass(this._dropdown,"mmc-dropdown-open-ul");elRemoveClass(this._dropdown,"top");elRemoveClass(this._dropdown_li,"mmc-dropdown-open");elRemoveClass(this._dropdown_li,"freeze");$(this._dropdown_li).attr("style","");c.attr("style","").off("mouseenter").off("mouseleave");this._dropdown=null;return this._dropdown_li=null};TinyAdmin.MainMenu.prototype.freezeDropdown=function(a){return a.className+=" freeze"};TinyAdmin.MainMenu.prototype.setupAnimation=function(){var b,d,c,a;c=document.body;a=TinyAdmin.settings.main_menu.disable_animation_on;c.className+=" dont-animate-mm-content";b=$("#main-menu");d=b.find(".navigation");d.find("> .mm-dropdown > ul").addClass("mmc-dropdown-delay animated");d.find("> li > a > .mm-text").addClass("mmc-dropdown-delay animated fadeIn");b.find(".menu-content").addClass("animated fadeIn");c.className+=a.indexOf("small")===-1?" animate-mm-sm":" dont-animate-mm-content-sm";c.className+=a.indexOf("tablet")===-1?" animate-mm-md":" dont-animate-mm-content-md";c.className+=a.indexOf("desktop")===-1?" animate-mm-lg":" dont-animate-mm-content-lg";return window.setTimeout(function(){return elRemoveClass(c,"dont-animate-mm-content")},500)};TinyAdmin.MainMenu.prototype.detectActiveItem=function(){var g,f,j,b,i,c,e,h,d;c=(document.location+"").replace(/\#.*?$/,"");i=TinyAdmin.settings.main_menu.detect_active_predicate;b=$("#main-menu .navigation");b.find("li").removeClass("open active");j=b[0].getElementsByTagName("a");f=(function(a){return function(k){k.className+=" active";if(!elHasClass(k.parentNode,"navigation")){k=k.parentNode.parentNode;k.className+=" open";return f(k)}}})(this);d=[];for(e=0,h=j.length;e<h;e++){g=j[e];if(g.href.indexOf("#")===-1&&i(g.href,c)){f(g.parentNode);break}else{d.push(void 0)}}return d};TinyAdmin.MainMenu.prototype._getMenuState=function(){return TinyAdmin.getStoredValue(TinyAdmin.settings.main_menu.store_state_key,null)};TinyAdmin.MainMenu.prototype._storeMenuState=function(a){if(!TinyAdmin.settings.main_menu.store_state){return}return TinyAdmin.storeValue(TinyAdmin.settings.main_menu.store_state_key,a?"collapsed":"expanded")};TinyAdmin.MainMenu.Constructor=TinyAdmin.MainMenu;TinyAdmin.addInitializer(function(){return TinyAdmin.initPlugin("main_menu",new TinyAdmin.MainMenu)})}).call(this);