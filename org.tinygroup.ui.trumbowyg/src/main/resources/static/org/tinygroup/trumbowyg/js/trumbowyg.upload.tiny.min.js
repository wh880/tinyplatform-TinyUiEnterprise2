(function(b){function a(e,d){var g=d.shift(),f=d;if(e!==null){if(f.length===0){return e[g]}if(typeof e==="object"){return a(e[g],f)}}return e}c();b.extend(true,b.trumbowyg,{langs:{en:{upload:"Upload",file:"File",uploadError:"Error"},zh_cn:{upload:"上传",file:"文件",uploadError:"错误"}},upload:{serverPath:typeof(UPLOAD_ACTION_URL)!="undefined"?UPLOAD_ACTION_URL:(contextPath+"/savepic.umupload"),fileFieldName:"upfile",data:[],headers:{},urlPropertyName:"url",statusPropertyName:"state",success:undefined,error:undefined},opts:{btnsDef:{upload:{func:function(h,g){var e,f=g.o.prefix;var d=g.openModalInsert(g.lang.upload,{file:{type:"file",required:true},alt:{label:"description"}},function(i){var j=new FormData();j.append(b.trumbowyg.upload.fileFieldName,e);b.trumbowyg.upload.data.map(function(k){j.append(k.name,k.value)});if(b("."+f+"progress",d).length===0){b("."+f+"modal-title",d).after(b("<div/>",{"class":f+"progress"}).append(b("<div/>",{"class":f+"progress-bar"})))}b.ajax({url:b.trumbowyg.upload.serverPath,headers:b.trumbowyg.upload.headers,type:"POST",data:j,cache:false,dataType:"json",processData:false,contentType:false,progressUpload:function(k){b("."+f+"progress-bar").stop().animate({width:Math.round(k.loaded*100/k.total)+"%"},200)},success:b.trumbowyg.upload.success||function(l){if(!!a(l,b.trumbowyg.upload.statusPropertyName.split("."))){var k=contextPath+a(l,b.trumbowyg.upload.urlPropertyName.split("."));g.execCmd("insertImage",k);b('img[src="'+k+'"]:not([alt])',g.$box).attr("alt",i.alt);setTimeout(function(){g.closeModal()},250)}else{g.addErrorOnModalField(b("input[type=file]",d),g.lang[l.message])}},error:b.trumbowyg.upload.error||function(){g.addErrorOnModalField(b("input[type=file]",d),g.lang.uploadError)}})});b("input[type=file]").on("change",function(j){try{e=j.target.files[0]}catch(i){e=j.target.value}})},ico:"insertImage"}}}});function c(){if(!b.trumbowyg&&!b.trumbowyg.addedXhrProgressEvent){var d=b.ajaxSettings.xhr;b.ajaxSetup({xhr:function(){var f=d(),e=this;if(f&&typeof f.upload=="object"&&e.progressUpload!==undefined){f.upload.addEventListener("progress",function(g){e.progressUpload(g)},false)}return f}});b.trumbowyg.addedXhrProgressEvent=true}}})(jQuery);