(function(a){a.fn.touchSlider=function(c){c.supportsCssTransitions=(function(g){var h=["Webkit","Moz","Ms"];for(var f=0,e=h.length;f<e;f++){if(typeof g[h[f]+"Transition"]!=="undefined"){return true}}return false})(document.createElement("div").style);c=jQuery.extend({roll:true,flexible:false,btn_prev:null,btn_next:null,paging:null,speed:75,view:1,range:0.15,page:1,transition:false,initComplete:null,counter:null,multi:false},c);var d=[];d=a.extend({},a.fn.touchSlider.defaults,c);return this.each(function(){a.fn.extend(this,b);var e=this;this.opts=d;this._view=this.opts.view;this._speed=this.opts.speed;this._tg=a(this);this._list=this._tg.children().children();this._width=parseInt(this._tg.css("width"));this._item_w=parseInt(this._list.css("width"));this._len=this._list.length;this._range=this.opts.range*this._width;this._pos=[];this._start=[];this._startX=0;this._startY=0;this._left=0;this._top=0;this._drag=false;this._scroll=false;this._btn_prev;this._btn_next;this.init();a(this).bind("touchstart",this.touchstart).bind("touchmove",this.touchmove).bind("touchend",this.touchend).bind("dragstart",this.touchstart).bind("drag",this.touchmove).bind("dragend",this.touchend);a(window).bind("orientationchange resize",function(){e.resize(e)})})};var b={init:function(){var e=this;a(this).children().css({width:this._width+"px",overflow:"visible"});if(this.opts.flexible){this._item_w=this._width/this._view}if(this.opts.roll){this._len=Math.ceil(this._len/this._view)*this._view}var c=(this.opts.page>1&&this.opts.page<=this._len)?(this.opts.page-1)*this._item_w:0;for(var d=0;d<this._len;++d){this._pos[d]=this._item_w*d-c;this._start[d]=this._pos[d];this._list.eq(d).css({"float":"none",display:"block",position:"absolute",top:"0",left:this._pos[d]+"px",width:this._item_w+"px"});if(this.opts.supportsCssTransitions&&this.opts.transition){this._list.eq(d).css({"-moz-transition":"0ms","-moz-transform":"","-ms-transition":"0ms","-ms-transform":"","-webkit-transition":"0ms","-webkit-transform":"",transition:"0ms",transform:""})}}if(this.opts.btn_prev&&this.opts.btn_next){this.opts.btn_prev.bind("click",function(){e.animate(1,true);return false});this.opts.btn_next.bind("click",function(){e.animate(-1,true);return false})}if(this.opts.paging){a(this._list).each(function(g,h){var f=e.opts.paging.eq(g);f.bind("click",function(i){e.go_page(g,i);return false})})}this.counter();this.initComplete()},initComplete:function(){if(typeof(this.opts.initComplete)=="function"){this.opts.initComplete(this)}},resize:function(f){if(f.opts.flexible){var c=f._item_w;f._width=parseInt(f._tg.css("width"));f._item_w=f._width/f._view;f._range=f.opts.range*f._width;for(var d=0;d<f._len;++d){f._pos[d]=f._pos[d]/c*f._item_w;f._start[d]=f._start[d]/c*f._item_w;f._list.eq(d).css({left:f._pos[d]+"px",width:f._item_w+"px"});if(this.opts.supportsCssTransitions&&this.opts.transition){f._list.eq(d).css({"-moz-transition":"0ms","-moz-transform":"","-ms-transition":"0ms","-ms-transform":"","-webkit-transition":"0ms","-webkit-transform":"",transition:"0ms",transform:""})}}}this.counter()},touchstart:function(d){if((d.type=="touchstart"&&d.originalEvent.touches.length<=1)||d.type=="dragstart"){this._startX=d.pageX||d.originalEvent.touches[0].pageX;this._startY=d.pageY||d.originalEvent.touches[0].pageY;this._scroll=false;this._start=[];for(var c=0;c<this._len;++c){this._start[c]=this._pos[c]}}},touchmove:function(k){if((k.type=="touchmove"&&k.originalEvent.touches.length<=1)||k.type=="drag"){this._left=(k.pageX||k.originalEvent.touches[0].pageX)-this._startX;this._top=(k.pageY||k.originalEvent.touches[0].pageY)-this._startY;var c=this._left<0?this._left*-1:this._left;var j=this._top<0?this._top*-1:this._top;if(c<j||this._scroll){this._left=0;this._drag=false;this._scroll=true}else{k.preventDefault();this._drag=true;this._scroll=false;this.position(k)}for(var g=0;g<this._len;++g){var f=this._start[g]+this._left;if(this.opts.supportsCssTransitions&&this.opts.transition){var d="translate3d("+f+"px,0,0)";this._list.eq(g).css({left:"","-moz-transition":"0ms","-moz-transform":d,"-ms-transition":"0ms","-ms-transform":d,"-webkit-transition":"0ms","-webkit-transform":d,transition:"0ms",transform:d})}else{this._list.eq(g).css("left",f+"px")}this._pos[g]=f}}},touchend:function(c){if((c.type=="touchend"&&c.originalEvent.touches.length<=1)||c.type=="dragend"){if(this._scroll){this._drag=false;this._scroll=false;return false}this.animate(this.direction());this._drag=false;this._scroll=false}},position:function(j){var k=this._view*this._item_w;if(j==-1||j==1){this._startX=0;this._start=[];for(var g=0;g<this._len;++g){this._start[g]=this._pos[g]}this._left=j*k}else{if(this._left>k){this._left=k}if(this._left<-k){this._left=-k}}if(this.opts.roll){var f=[];for(var g=0;g<this._len;++g){f[g]=this._pos[g]}f.sort(function(i,d){return i-d});var c=f[this._len-this._view];var h=a.inArray(f[0],this._pos);var e=a.inArray(c,this._pos);if(this._view<=1){c=this._len-1}if(this.opts.multi){if((j==1&&f[0]>=0)||(this._drag&&f[0]>=100)){for(var g=0;g<this._view;++g,++h,++e){this._start[e]=this._start[h]-k;this._list.eq(e).css("left",this._start[e]+"px")}}else{if((j==-1&&f[0]<=0)||(this._drag&&f[0]<=-100)){for(var g=0;g<this._view;++g,++h,++e){this._start[h]=this._start[e]+k;this._list.eq(h).css("left",this._start[h]+"px")}}}}else{if((j==1&&f[0]>=0)||(this._drag&&f[0]>0)){for(var g=0;g<this._view;++g,++h,++e){this._start[e]=this._start[h]-k;this._list.eq(e).css("left",this._start[e]+"px")}}else{if((j==-1&&f[c]<=0)||(this._drag&&f[c]<=0)){for(var g=0;g<this._view;++g,++h,++e){this._start[h]=this._start[e]+k;this._list.eq(h).css("left",this._start[h]+"px")}}}}}else{if(this.limit_chk()){this._left=this._left/2}}},animate:function(f,c){if(this._drag||!this._scroll||c){var h=this;var e=this._speed;if(c){this.position(f)}var g=f*(this._item_w*this._view);if(this._left==0||(!this.opts.roll&&this.limit_chk())){g=0}this._list.each(function(j,k){h._pos[j]=h._start[j]+g;if(h.opts.supportsCssTransitions&&h.opts.transition){var l=e+"ms";var d="translate3d("+h._pos[j]+"px,0,0)";if(c){l="0ms"}a(this).css({left:"","-moz-transition":l,"-moz-transform":d,"-ms-transition":l,"-ms-transform":d,"-webkit-transition":l,"-webkit-transform":d,transition:l,transform:d})}else{a(this).stop();a(this).animate({left:h._pos[j]+"px"},e)}});this.counter()}},direction:function(){var c=0;if(this._left<-(this._range)){c=-1}else{if(this._left>this._range){c=1}}if(!this._drag||this._scroll){c=0}return c},limit_chk:function(){var c=parseInt((this._len-1)/this._view)*this._view;return((this._start[0]==0&&this._left>0)||(this._start[c]==0&&this._left<0))},go_page:function(d,g){var c=(a.inArray(0,this._pos)/this._view)+1;var f=c-(d+1);while(f!=0){if(f<0){this.animate(-1,true);f++}else{if(f>0){this.animate(1,true);f--}}}},counter:function(){if(typeof(this.opts.counter)=="function"){var c={total:Math.ceil(this._len/this._view),current:(a.inArray(0,this._pos)/this._view)+1};this.opts.counter(c)}}}})(jQuery);