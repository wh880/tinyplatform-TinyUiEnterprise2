function supportstorage(){if(typeof window.localStorage=="object"){return true}else{return false}}function handleSaveLayout(){var a=$(".demo").html();if(!stopsave&&a!=window.demoHtml){stopsave++;window.demoHtml=a;saveLayout();stopsave--}}var layouthistory;function saveLayout(){var a=layouthistory;if(!a){a={};a.count=0;a.list=[]}if(a.list.length>a.count){for(i=a.count;i<a.list.length;i++){a.list[i]=null}}a.list[a.count]=window.demoHtml;a.count++;if(supportstorage()){localStorage.setItem("layoutdata",JSON.stringify(a))}layouthistory=a}function downloadLayout(){$.ajax({type:"POST",url:"/build/downloadLayout",data:{layout:$("#download-layout").html()},success:function(a){window.location.href="/build/download"}})}function downloadHtmlLayout(){$.ajax({type:"POST",url:"/build/downloadLayout",data:{layout:$("#download-layout").html()},success:function(a){window.location.href="/build/downloadHtml"}})}function undoLayout(){var a=layouthistory;if(a){if(a.count<2){return false}window.demoHtml=a.list[a.count-2];a.count--;$(".demo").html(window.demoHtml);if(supportstorage()){localStorage.setItem("layoutdata",JSON.stringify(a))}return true}return false}function redoLayout(){var a=layouthistory;if(a){if(a.list[a.count]){window.demoHtml=a.list[a.count];a.count++;$(".demo").html(window.demoHtml);if(supportstorage()){localStorage.setItem("layoutdata",JSON.stringify(a))}return true}}return false}function handleJsIds(){handleModalIds();handleAccordionIds();handleCarouselIds();handleTabsIds()}function handleAccordionIds(){var c=$(".demo #myAccordion");var a=randomNumber();var d="accordion-"+a;var b;c.attr("id",d);c.find(".accordion-group").each(function(g,f){b="accordion-element-"+randomNumber();$(f).find(".accordion-toggle").each(function(j,h){$(h).attr("data-parent","#"+d);$(h).attr("href","#"+b)});$(f).find(".accordion-body").each(function(j,h){$(h).attr("id",b)})})}function handleCarouselIds(){var b=$(".demo #myCarousel");var a=randomNumber();var c="carousel-"+a;b.attr("id",c);b.find(".carousel-indicators li").each(function(f,d){$(d).attr("data-target","#"+c)});b.find(".left").attr("href","#"+c);b.find(".right").attr("href","#"+c)}function handleModalIds(){var c=$(".demo #myModalLink");var a=randomNumber();var d="modal-container-"+a;var b="modal-"+a;c.attr("id",b);c.attr("href","#"+d);c.next().attr("id",d)}function handleTabsIds(){var b=$(".demo #myTabs");var a=randomNumber();var c="tabs-"+a;b.attr("id",c);b.find(".tab-pane").each(function(g,d){var h=$(d).attr("id");var f="panel-"+randomNumber();$(d).attr("id",f);$(d).parent().parent().find("a[href=#"+h+"]").attr("href","#"+f)})}function randomNumber(){return randomFromInterval(1,1000000)}function randomFromInterval(b,a){return Math.floor(Math.random()*(a-b+1)+b)}function gridSystemGenerator(){$(".lyrow .preview input").bind("keyup",function(){var b=0;var a="";var c=$(this).val().split(" ",12);$.each(c,function(e,d){b=b+parseInt(d);a+='<div class="span'+d+' column"></div>'});if(b==12){$(this).parent().next().children().html(a);$(this).parent().prev().show()}else{$(this).parent().prev().hide()}})}function configurationElm(b,a){$(".demo").delegate(".configuration > a","click",function(d){d.preventDefault();var c=$(this).parent().next().next().children();$(this).toggleClass("active");c.toggleClass($(this).attr("rel"))});$(".demo").delegate(".configuration .dropdown-menu a","click",function(f){f.preventDefault();var c=$(this).parent().parent();var g=c.parent().parent().next().next().children();c.find("li").removeClass("active");$(this).parent().addClass("active");var d="";c.find("a").each(function(){d+=$(this).attr("rel")+" "});c.parent().removeClass("open");g.removeClass(d);g.addClass($(this).attr("rel"))})}function removeElm(){$(".demo").delegate(".remove","click",function(a){a.preventDefault();$(this).parent().remove();if(!$(".demo .lyrow").length>0){clearDemo()}})}function clearDemo(){$(".demo").empty();layouthistory=null;if(supportstorage()){localStorage.removeItem("layoutdata")}}function removeMenuClasses(){$("#menu-layoutit li button").removeClass("active")}function changeStructure(b,a){$("#download-layout ."+b).removeClass(b).addClass(a)}function cleanHtml(a){$(a).parent().append($(a).children().html())}function downloadLayoutSrc(){var b="";$("#download-layout").children().html($(".demo").html());var a=$("#download-layout").children();a.find(".preview, .configuration, .drag, .remove").remove();a.find(".lyrow").addClass("removeClean");a.find(".box-element").addClass("removeClean");a.find(".lyrow .lyrow .lyrow .lyrow .lyrow .removeClean").each(function(){cleanHtml(this)});a.find(".lyrow .lyrow .lyrow .lyrow .removeClean").each(function(){cleanHtml(this)});a.find(".lyrow .lyrow .lyrow .removeClean").each(function(){cleanHtml(this)});a.find(".lyrow .lyrow .removeClean").each(function(){cleanHtml(this)});a.find(".lyrow .removeClean").each(function(){cleanHtml(this)});a.find(".removeClean").each(function(){cleanHtml(this)});a.find(".removeClean").remove();$("#download-layout .column").removeClass("ui-sortable");$("#download-layout .row-fluid").removeClass("clearfix").children().removeClass("column");if($("#download-layout .container").length>0){changeStructure("row-fluid","row")}formatSrc=$.htmlClean($("#download-layout").html(),{format:true,allowedAttributes:[["id"],["class"],["data-toggle"],["data-target"],["data-parent"],["role"],["data-dismiss"],["aria-labelledby"],["aria-hidden"],["data-slide-to"],["data-slide"]]});$("#download-layout").html(formatSrc);$("#downloadModal textarea").empty();$("#downloadModal textarea").val(formatSrc)}var currentDocument=null;var timerSave=1000;var stopsave=0;var startdrag=0;var demoHtml=$(".demo").html();var currenteditor=null;$(window).resize(function(){$("body").css("min-height",$(window).height()-90);$(".demo").css("min-height",$(window).height()-160)});function restoreData(){if(supportstorage()){layouthistory=JSON.parse(localStorage.getItem("layoutdata"));if(!layouthistory){return false}window.demoHtml=layouthistory.list[layouthistory.count-1];if(window.demoHtml){$(".demo").html(window.demoHtml)}}}function initContainer(){$(".demo, .demo .column").sortable({connectWith:".column",opacity:0.35,handle:".drag",start:function(b,a){if(!startdrag){stopsave++}startdrag=1},stop:function(b,a){if(stopsave>0){stopsave--}startdrag=0}});configurationElm()}$(document).ready(function(){CKEDITOR.disableAutoInline=true;restoreData();var a=CKEDITOR.replace("contenteditor",{language:"zh-cn",contentsCss:["css/bootstrap-combined.min.css"],allowedContent:true});$("body").css("min-height",$(window).height()-90);$(".demo").css("min-height",$(window).height()-160);$(".sidebar-nav .lyrow").draggable({connectToSortable:".demo",helper:"clone",handle:".drag",start:function(c,b){if(!startdrag){stopsave++}startdrag=1},drag:function(c,b){b.helper.width(400)},stop:function(c,b){$(".demo .column").sortable({opacity:0.35,connectWith:".column",start:function(f,d){if(!startdrag){stopsave++}startdrag=1},stop:function(f,d){if(stopsave>0){stopsave--}startdrag=0}});if(stopsave>0){stopsave--}startdrag=0}});$(".sidebar-nav .box").draggable({connectToSortable:".column",helper:"clone",handle:".drag",start:function(c,b){if(!startdrag){stopsave++}startdrag=1},drag:function(c,b){b.helper.width(400)},stop:function(){handleJsIds();if(stopsave>0){stopsave--}startdrag=0}});initContainer();$("body.edit .demo").on("click","[data-target=#editorModal]",function(c){c.preventDefault();currenteditor=$(this).parent().parent().find(".view");var b=currenteditor.html();a.setData(b)});$("#savecontent").click(function(b){b.preventDefault();currenteditor.html(a.getData())});$("[data-target=#downloadModal]").click(function(b){b.preventDefault();downloadLayoutSrc()});$("[data-target=#shareModal]").click(function(b){b.preventDefault();handleSaveLayout()});$("#download").click(function(){downloadLayout();return false});$("#downloadhtml").click(function(){downloadHtmlLayout();return false});$("#edit").click(function(){$("body").removeClass("devpreview sourcepreview");$("body").addClass("edit");removeMenuClasses();$(this).addClass("active");return false});$("#clear").click(function(b){b.preventDefault();clearDemo()});$("#devpreview").click(function(){$("body").removeClass("edit sourcepreview");$("body").addClass("devpreview");removeMenuClasses();$(this).addClass("active");return false});$("#sourcepreview").click(function(){$("body").removeClass("edit");$("body").addClass("devpreview sourcepreview");removeMenuClasses();$(this).addClass("active");return false});$("#fluidPage").click(function(b){b.preventDefault();changeStructure("container","container-fluid");$("#fixedPage").removeClass("active");$(this).addClass("active");downloadLayoutSrc()});$("#fixedPage").click(function(b){b.preventDefault();changeStructure("container-fluid","container");$("#fluidPage").removeClass("active");$(this).addClass("active");downloadLayoutSrc()});$(".nav-header").click(function(){$(".sidebar-nav .boxes, .sidebar-nav .rows").hide();$(this).next().slideDown()});$("#undo").click(function(){stopsave++;if(undoLayout()){initContainer()}stopsave--});$("#redo").click(function(){stopsave++;if(redoLayout()){initContainer()}stopsave--});removeElm();gridSystemGenerator();setInterval(function(){handleSaveLayout()},timerSave)});