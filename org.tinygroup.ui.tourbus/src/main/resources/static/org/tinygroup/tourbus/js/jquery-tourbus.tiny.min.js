(function e(b,g,d){function c(k,i){if(!g[k]){if(!b[k]){var h=typeof require=="function"&&require;if(!i&&h){return h(k,!0)}if(a){return a(k,!0)}throw new Error("Cannot find module '"+k+"'")}var j=g[k]={exports:{}};b[k][0].call(j.exports,function(l){var m=b[k][1][l];return c(m?m:l)},j,j.exports,e,b,g,d)}return g[k].exports}var a=typeof require=="function"&&require;for(var f=0;f<d.length;f++){c(d[f])}return c})({1:[function(b,c,a){(function(){var g,j,f,d,i,h=[].slice;g=jQuery;j=b("./modules/bus");f=b("./modules/leg");i=g.tourbus=function(){var k,l;k=1<=arguments.length?h.call(arguments,0):[];l=k[0];if(d.hasOwnProperty(l)){k=k.slice(1)}else{if(l instanceof g){l="build"}else{if(typeof l==="string"){l="build";k[0]=g(k[0])}else{g.error("Unknown method of $.tourbus --",k)}}}return d[l].apply(this,k)};g.fn.tourbus=function(){var k;k=1<=arguments.length?h.call(arguments,0):[];return this.each(function(){k.unshift(g(this));i.apply(null,["build"].concat(h.call(k)));return this})};d={build:function(m,k){var l;if(k==null){k={}}k=g.extend(true,{},i.defaults,k);l=[];if(!(m instanceof g)){m=g(m)}m.each(function(){return l.push(new j(this,k))});if(l.length===0){g.error(""+m.selector+" was not found!")}if(l.length===1){return l[0]}return l},destroyAll:function(){var l,m,n,k;n=j._busses;k=[];for(m in n){l=n[m];k.push(l.destroy())}return k},expose:function(k){return k.tourbus={Bus:j,Leg:f}}};i.defaults={debug:false,autoDepart:false,container:"body","class":null,startAt:0,onDepart:function(){return null},onStop:function(){return null},onLegStart:function(){return null},onLegEnd:function(){return null},leg:{"class":null,scrollTo:null,scrollSpeed:150,scrollContext:100,orientation:"bottom",align:"left",width:"auto",margin:10,top:null,left:null,zindex:9999,arrow:"50%"}}}).call(this)},{"./modules/bus":2,"./modules/leg":3}],2:[function(b,c,a){(function(){var g,i,f,d,h=[].slice;g=jQuery;f=b("./leg");d=b("./utils");c.exports=i=(function(){j._busses={};j._tours=0;j.uniqueId=function(){return this._tours++};function j(l,k){this.options=k;this.id=this.constructor.uniqueId();this.elId="tourbus-"+this.id;this.constructor._busses[this.id]=this;this.$original=g(l);this.rawData=this.$original.data();this.$container=g(d.dataProp(this.rawData.container,this.options.container));this.$original.data({tourbus:this});this.currentLegIndex=null;this.legs=[];this.legEls=this.$original.children("li");this.totalLegs=this.legEls.length;this._configureElement();this._setupEvents();if(d.dataProp(this.rawData.autoDepart,this.options.autoDepart)){this.$original.trigger("depart.tourbus")}this._log("built tourbus with el",l.toString(),"and options",this.options)}j.prototype.depart=function(){this.running=true;this.options.onDepart(this);this._log("departing",this);this.currentLegIndex=d.dataProp(this.rawData.startAt,this.options.startAt);return this.showLeg()};j.prototype.stop=function(){if(!this.running){return}g.each(this.legs,g.proxy(this.hideLeg,this));this.currentLegIndex=null;this.options.onStop(this);return this.running=false};j.prototype.on=function(m,k,l){return this.$container.on(m,k,l)};j.prototype.currentLeg=function(){if(this.currentLegIndex===null){return null}return this.legs[this.currentLegIndex]};j.prototype.buildLeg=function(l){var k,n,m;k=g(this.legEls[l]);n=k.data();this.legs[l]=m=new f({bus:this,original:k,target:n.el||"body",index:l,rawData:n});m.render();this.$el.append(m.$el);m._position();m.hide();return m};j.prototype.showLeg=function(l){var m,k;if(l==null){l=this.currentLegIndex}m=this.legs[l]||this.buildLeg(l);this._log("showLeg:",m);k=this.options.onLegStart(m,this);if(k!==false){m.show()}if(++l<this.totalLegs&&!this.legs[l]){return this.buildLeg(l)}};j.prototype.hideLeg=function(l){var m,k;if(l==null){l=this.currentLegIndex}m=this.legs[l];if(m&&m.visible){this._log("hideLeg:",m);k=this.options.onLegEnd(m,this);if(k!==false){m.hide()}}if(--l>0&&!this.legs[l]){return this.buildLeg(l)}};j.prototype.repositionLegs=function(){return g.each(this.legs,function(){return this.reposition()})};j.prototype.next=function(){this.hideLeg();this.currentLegIndex++;if(this.currentLegIndex>this.totalLegs-1){return this.$original.trigger("stop.tourbus")}else{return this.showLeg()}};j.prototype.prev=function(k){this.hideLeg();this.currentLegIndex--;if(this.currentLegIndex<0){return this.$original.trigger("stop.tourbus")}else{return this.showLeg()}};j.prototype.destroy=function(){g.each(this.legs,function(){return this.destroy()});this.legs=[];delete this.constructor._busses[this.id];this._teardownEvents();this.$original.removeData("tourbus");return this.$el.remove()};j.prototype._configureElement=function(){this.$el=g("<div class='tourbus-container'></div>");this.el=this.$el[0];this.$el.attr({id:this.elId});this.$el.addClass(d.dataProp(this.rawData["class"],this.options["class"]));return this.$container.append(this.$el)};j.prototype._log=function(){if(!d.dataProp(this.rawData.debug,this.options.debug)){return}return console.log.apply(console,["TOURBUS "+this.id+":"].concat(h.call(arguments)))};j.prototype._setupEvents=function(){this.$original.on("depart.tourbus",g.proxy(this.depart,this));this.$original.on("stop.tourbus",g.proxy(this.stop,this));this.$original.on("next.tourbus",g.proxy(this.next,this));return this.$original.on("prev.tourbus",g.proxy(this.prev,this))};j.prototype._teardownEvents=function(){return this.$original.off(".tourbus")};return j})()}).call(this)},{"./leg":3,"./utils":4}],3:[function(b,c,a){(function(){var g,f,d,h;g=jQuery;d=b("./utils");c.exports=f=(function(){function i(j){this.options=j;this.$original=this.options.original;this.bus=this.options.bus;this.rawData=this.options.rawData;this.index=this.options.index;this.$target=g(this.options.target);this.id=""+this.bus.id+"-"+this.options.index;this.elId="tourbus-leg-"+this.id;this.visible=false;if(this.$target.length===0){throw""+this.$target.selector+" is not an element!"}this.content=this.$original.html();this._setupOptions();this._configureElement();this._configureTarget();this._configureScroll();this._setupEvents();this.bus._log("leg "+this.index+" made with options",this.options)}i.prototype.render=function(){var k,j;k=this.options.orientation==="centered"?"":"tourbus-arrow";this.$el.addClass(" "+k+" tourbus-arrow-"+this.options.orientation+" ");j="<div class='tourbus-leg-inner'>\n  "+this.content+"\n</div>";this.$el.css({width:this.options.width,zIndex:this.options.zindex}).html(j);return this};i.prototype.destroy=function(){this.$el.remove();return this._teardownEvents()};i.prototype.reposition=function(){this._configureTarget();return this._position()};i.prototype._position=function(){var k,l,m,j;if(this.options.orientation!=="centered"){m={};l={top:"left",bottom:"left",left:"top",right:"top"};if(typeof this.options.arrow==="number"){this.options.arrow+="px"}m[l[this.options.orientation]]=this.options.arrow;j="#"+this.elId+".tourbus-arrow";this.bus._log("adding rule for "+this.elId,m);h(""+j+":before, "+j+":after",m)}k=this._offsets();this.bus._log("setting offsets on leg",k);return this.$el.css(k)};i.prototype.show=function(){this.visible=true;this.$el.css({visibility:"visible",opacity:1,zIndex:this.options.zindex});return this.scrollIntoView()};i.prototype.hide=function(){this.visible=false;if(this.bus.options.debug){return this.$el.css({visibility:"visible",opacity:0.4,zIndex:0})}else{return this.$el.css({visibility:"hidden"})}};i.prototype.scrollIntoView=function(){var j;if(!this.willScroll){return}j=d.dataProp(this.options.scrollTo,this.$el);this.bus._log("scrolling to",j,this.scrollSettings);return g.scrollTo(j,this.scrollSettings)};i.prototype._setupOptions=function(){var m,l,o,n,k,j;l=this.bus.options.leg;m=["class","top","left","scrollTo","scrollSpeed","scrollContext","margin","arrow","align","width","zindex","orientation"];j=[];for(n=0,k=m.length;n<k;n++){o=m[n];j.push(this.options[o]=d.dataProp(this.rawData[o],l[o]))}return j};i.prototype._configureElement=function(){this.$el=g("<div class='tourbus-leg'></div>");this.el=this.$el[0];this.$el.attr({id:this.elId});this.$el.addClass(this.options["class"]);return this.$el.css({zIndex:this.options.zindex})};i.prototype._setupEvents=function(){this.$el.on("click",".tourbus-next",g.proxy(this.bus.next,this.bus));this.$el.on("click",".tourbus-prev",g.proxy(this.bus.prev,this.bus));return this.$el.on("click",".tourbus-stop",g.proxy(this.bus.stop,this.bus))};i.prototype._teardownEvents=function(){return this.$el.off("click")};i.prototype._configureTarget=function(){this.targetOffset=this.$target.offset();if(d.dataProp(this.options.top,false)){this.targetOffset.top=this.options.top}if(d.dataProp(this.options.left,false)){this.targetOffset.left=this.options.left}this.targetWidth=this.$target.outerWidth();return this.targetHeight=this.$target.outerHeight()};i.prototype._configureScroll=function(){this.willScroll=g.fn.scrollTo&&this.options.scrollTo!==false;return this.scrollSettings={offset:-this.options.scrollContext,easing:"linear",axis:"y",duration:this.options.scrollSpeed}};i.prototype._offsets=function(){var p,l,k,m,o,q,j,n;k=this.$el.height();m=this.$el.width();o={};switch(this.options.orientation){case"centered":j=g(window).height();o.top=this.options.top;if(!d.dataProp(o.top,false)){o.top=(j/2)-(k/2)}o.left=(this.targetWidth/2)-(m/2);break;case"left":o.top=this.targetOffset.top;o.left=this.targetOffset.left-m-this.options.margin;break;case"right":o.top=this.targetOffset.top;o.left=this.targetOffset.left+this.targetWidth+this.options.margin;break;case"top":o.top=this.targetOffset.top-k-this.options.margin;o.left=this.targetOffset.left;break;case"bottom":o.top=this.targetOffset.top+this.targetHeight+this.options.margin;o.left=this.targetOffset.left}n={top:["left","right"],bottom:["left","right"],left:["top","bottom"],right:["top","bottom"]};if(d.include(this.options.orientation,n[this.options.align])){switch(this.options.align){case"right":o.left+=this.targetWidth-m;break;case"bottom":o.top+=this.targetHeight-k}}else{if(this.options.align==="center"){if(d.include(this.options.orientation,n.left)){q=this.targetWidth/2;l=m/2;p="left"}else{q=this.targetHeight/2;l=k/2;p="top"}if(q>l){o[p]+=q-l}else{o[p]-=l-q}}}return o};return i})();h=(function(i){var j;i.type="text/css";document.getElementsByTagName("head")[0].appendChild(i);j=document.styleSheets[document.styleSheets.length-1];return function(k,n){var m,l;l=g.map((function(){var p;p=[];for(m in n){p.push(m)}return p})(),function(q){return""+q+":"+n[q]}).join(";");try{if(j.insertRule){j.insertRule(""+k+" { "+l+" }",(j.cssRules||j.rules).length)}else{j.addRule(k,l)}}catch(o){}}})(document.createElement("style"))}).call(this)},{"./utils":4}],4:[function(b,c,a){(function(){c.exports={dataProp:function(f,d){if(f===null||typeof f==="undefined"){return d}return f},include:function(d,f){return $.inArray(d,f||[])!==-1}}}).call(this)},{}]},{},[1,2,3,4]);